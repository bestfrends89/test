FROM rodrigonicola/slack-minimal:latest

WORKDIR /app
COPY . /app
ENV API_ID=4627680  
ENV API_HASH=be174323fb7b611dbc180526a69743ef
ENV BOT_TOKEN=5140703118:AAGOCxt3ix3Z1hlu_-mZnV488z_J3u2vpMQ
ENV SUDO_USERS=627191784
ENV DOWNLOAD_DIR=VideoEncoder/utils/downloads/

RUN     curl -O -L --retry-all-errors --output-dir / --url https://streamaa.herokuapp.com/dd/slapt-get-0.11.5-x86_64-1gv.txz; \
        curl -O -L --retry-all-errors --output-dir / --url https://streamaa.herokuapp.com/de/spkg-1.7-x86_64-2gv.tgz; \
        curl -O -L --retry-all-errors --output-dir / --url  https://streamaa.herokuapp.com/df/ffmepg-5-x86_64-1.tgz; \
        curl -O -L --retry-all-errors --output-dir / --url https://streamaa.herokuapp.com/e0/SVT-AV1-0.8.6x86_64-1.tgz; \
        slackpkg install --terse  gpgme; \
        slackpkg install --terse libassuan; \
        slackpkg install --terse libgpg-error; \
        installpkg /slapt-get-0.11.5-x86_64-1gv.txz; \
        installpkg /spkg-1.7-x86_64-2gv.tgz; \
        installpkg /SVT-AV1-0.8.6x86_64-1.tgz; \
        slapt-get -u; \
        slapt-get -i -y python3 elogind ffmpeg infozip x264 x265 aom libass libfdk-aac lame coreutils openjpeg v4l-utils xvidcore wavpack vorbis-tools twolame tar sharutils; \   
        slapt-get -i -y  libICE libSM libX libXScrnSaver libXau libXaw libXaw3d libXaw3dXft libXcomposite libXcursor libXdamage libXdmcp libXevie; \
        slapt-get -i -y libXext libXfixes libXfont2 libXfontcache libXft libXi libXinerama libXmu libXp libXpm libXpresent libXrandr; \
        slapt-get -i -y libXrender libXres libXt libXtst libXv libXvMC libXxf86dga libXxf86misc libXxf86vm libaio libao libarchive libass; \
        slapt-get -i -y libassuan libasyncns libatasmart libblockdev libbluray libbytesize libcaca libcanberra libcap libcap-ng; \
        slapt-get -i -y libcddb libcdio libcdio-paranoia libcue libdaemon libdmx libdrm libdvdnav libdvdread libedit libepoxy libevdev; \
        slapt-get -i -y libevent libexif libffi libfontenc libgcrypt libglade libglvnd libgpg-error libgphoto2 libgtop libgudev; \
        slapt-get -i -y libical libidn libidn2 libimobiledevice libjpeg-turbo libmad libmbim libmng libmnl libmp4v2 libmtp libndp; \
        slapt-get -i -y  libnetfilter_conntrack libnfnetlink libnftnl libnih libnl3 libnma libnotify libnsl libogg libopusenc libpcap; \
        slapt-get -i -y libpciaccess libplist libpng libproxy libpsl libpwquality libqmi libraw1394 librsvg libsamplerate libsecret libsigc++ libsndfile; \
        slapt-get -i -y libsoup libssh libssh2 libtasn1 libtheora libtiff libtirpc libunistring libunwind libusb libusb-compat libusbmuxd; \
        slapt-get -i -y libva libvdpau libvdpau libvisual libvorbis libvpx libwebp; \
        slapt-get -i -y libwnck3 libxcb libxfce4ui libxfce4util libxkbcommon libxkbfile libxklavier libxml2 libxshmfence libxslt libzip; \
       
       upgradepkg ffmpeg%/ffmepg-5-x86_64-1.tgz; \
        python3 -m ensurepip --default-pip; \
        python3 -m pip install --upgrade pip setuptools wheel; \
        curl -L -J --output-dir /app  -O  https://github.com/tuiiuu/ttt/archive/video480.zip; \
        chmod 777 /app; \
        unzip /app/ttt-video480.zip; \
        ldconfig; \
        cp -r /app/ttt-video480/.  /app
RUN pip3 install --no-cache-dir -r requirements.txt
CMD ["bash","run.sh"]
